{% extends "base.html" %}

{% block title %}Flag Guessing Game - Audio Classifier{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- Game Header -->
            <div class="text-center mb-5">
                <h1 class="display-4 mb-3">\ud83c\udfd1 Flag Guessing Game</h1>
                <p class="lead">Say the country name out loud when you see the flag!</p>
                <div class="score-display">
                    <span class="badge bg-success fs-5">Score: <span id="score">0</span></span>
                    <span class="badge bg-info fs-5 ms-3">Round: <span id="round">1</span>/10</span>
                </div>
            </div>

            <!-- Game Area -->
            <div class="game-container text-center p-5 bg-light rounded-3 shadow-sm">
                <!-- Flag Display -->
                <div class="flag-display mb-4">
                    <div class="flag-emoji" id="flagEmoji">\ud83c\uddfa\ud83c\uddf8</div>
                    <div class="flag-text mt-2">
                        <span class="text-muted">Say the country name out loud!</span>
                    </div>
                </div>

                <!-- Recording Controls -->
                <div class="recording-controls mb-4">
                    <button id="startRecording" class="btn btn-primary btn-lg me-3">
                        <i class="fas fa-microphone"></i> Start Recording
                    </button>
                    <button id="stopRecording" class="btn btn-danger btn-lg" style="display: none;">
                        <i class="fas fa-stop"></i> Stop Recording
                    </button>
                </div>

                <!-- Timer -->
                <div class="timer-display mb-4">
                    <div class="progress" style="height: 10px;">
                        <div id="timerBar" class="progress-bar bg-warning" style="width: 100%"></div>
                    </div>
                    <small class="text-muted">Time remaining: <span id="timerText">5</span>s</small>
                </div>

                <!-- Result Display -->
                <div id="resultDisplay" class="result-area" style="display: none;">
                    <div class="alert alert-info">
                        <div id="aiPredictions"></div>
                    </div>
                </div>

                <!-- Next Round Button -->
                <div id="nextRoundBtn" class="mt-4" style="display: none;">
                    <button id="nextRound" class="btn btn-success btn-lg">
                        <i class="fas fa-arrow-right"></i> Next Round
                    </button>
                </div>

                <!-- Game Over Modal -->
                <div id="gameOverModal" class="modal fade" tabindex="-1">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">\ud83c\udf89 Game Complete!</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <h4>Final Score: <span id="finalScore">0</span>/10</h4>
                                <p class="text-muted">Great job! Try again to improve your score.</p>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-primary" onclick="restartGame()">
                                    <i class="fas fa-redo"></i> Play Again
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Instructions -->
            <div class="mt-4">
                <div class="card">
                    <div class="card-body">
                        <h5><i class="fas fa-info-circle"></i> How to Play:</h5>
                        <ol class="mb-0">
                            <li>Click "Start Recording" when you see a flag</li>
                            <li>Say the country name clearly into your microphone</li>
                            <li>Click "Stop Recording" when you're done</li>
                            <li>See if the AI guessed correctly!</li>
                            <li>Complete 10 rounds to finish the game</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// ... Everything remains unchanged until showResults()

function showResults(result) {
    const predictions = result.predictions || [];
    const topPrediction = predictions[0];

    let predictionsHtml = `
        <div class="text-center">
            <h5>\ud83e\uddd0 The AI Heard:</h5>
            <div class="display-4 mb-2">${flagMap[topPrediction.country] || 'üè≥Ô∏è'} ${topPrediction.country}</div>
            <p class="lead">Confidence: ${topPrediction.confidence.toFixed(1)}%</p>
        </div>
    `;

    document.getElementById('aiPredictions').innerHTML = predictionsHtml;
    document.getElementById('resultDisplay').style.display = 'block';
    document.getElementById('nextRoundBtn').style.display = 'block';

    if (topPrediction && topPrediction.country === currentFlag) {
        score++;
        document.getElementById('score').textContent = score;
    }
}
</script>

<style>
.flag-emoji {
    font-size: 8rem;
    margin: 2rem 0;
}

.game-container {
    min-height: 400px;
    display: flex;
    flex-direction: column;
    justify-content: center;
}

.recording-controls {
    margin: 2rem 0;
}

.timer-display {
    margin: 1rem 0;
}

.result-area {
    margin: 2rem 0;
}

.score-display {
    margin: 1rem 0;
}

.card {
    transition: transform 0.2s;
}

.card:hover {
    transform: translateY(-2px);
}
</style>
{% endblock %}
